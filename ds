#!/bin/bash

set -e

setup_all() {
  sudo apt -y update && sudo apt -y upgrade
  sudo apt -y install build-essential
}

setup_git() {
  sudo apt -y install git
  wget -O $HOME/.gitconfig https://raw.githubusercontent.com/kazimir-malevich/dotfiles/master/.gitconfig
}

setup_bash() {
if grep -q "alias vi='vim'" ~/.bashrc; then return 0; fi

cat <<EOT >> $HOME/.bashrc

alias vi='vim'
alias ..="cd .."
alias ll='ls -lahF'
alias cl='clear'
alias py='python'

export PATH=~/.npm-global/bin:$PATH

EOT
}

setup_rust() {
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
  source "$HOME/.cargo/env"
  rustup component add rust-src
  rustup component add rust-analyzer
  # https://github.com/helix-editor/helix/wiki/How-to-install-the-default-language-servers#rust
  sudo ln -s $(rustup which rust-analyzer ) /usr/local/bin/rust-analyzer
}

setup_js() {
  dir=~/.npm-global
  sudo apt -y install nodejs npm
  [[ -d $dir ]] || mkdir $dir
  npm config set prefix $dir
  npm install -g eslint
  npm install -g prettier
  npm install -g yarn
}

setup_misc() {
  sudo apt -y install tree
  npm install -g tldr
}

teardown_all() {
  sudo apt -y autoremove
}

setup_all
setup_git
setup_rust
setup_js
setup_bash
setup_misc
teardown_all
