#!/bin/bash

set -e

setup_all() {
  sudo apt -y update && sudo apt -y upgrade
  sudo apt -y install build-essential
  rm -rf $HOME/.vim
}

setup_git() {
  sudo apt -y install git
  wget -O $HOME/.gitconfig https://raw.githubusercontent.com/kazimir-malevich/dotfiles/master/.gitconfig
}

setup_vim() {
  plugins_start_dir="$HOME/.vim/pack/plugins/start/"

  sudo apt -y install vim
  wget -O $HOME/.vimrc https://raw.githubusercontent.com/kazimir-malevich/dotfiles/master/.vimrc

  mkdir -p $plugins_start_dir && cd $plugins_start_dir

  declare -a plugins

  plugins=("tpope/vim-commentary" "ctrlpvim/ctrlp.vim.git" \
    "sheerun/vim-polyglot" "dense-analysis/ale" "christoomey/vim-tmux-navigator")

  cd $plugins_start_dir

  for i in ${plugins[@]}; do
    git clone --depth 1 "https://github.com/${i}"
  done

  cd

}

setup_tmux() {
  sudo apt -y install tmux
  wget -O $HOME/.tmux.conf https://raw.githubusercontent.com/kazimir-malevich/dotfiles/master/.tmux.conf
}

setup_bash() {
if grep -q "alias vi='vim'" ~/.bashrc; then return 0; fi

cat <<EOT >> $HOME/.bashrc

alias vi='vim'
alias ..="cd .."
alias ll='ls -lahF'
alias cl='clear'
alias py='python'

export PATH=~/.npm-global/bin:$PATH

EOT
}

setup_js() {
  dir=~/.npm-global
  sudo apt -y install nodejs npm
  [[ -d $dir ]] || mkdir $dir
  npm config set prefix $dir
  npm install -g eslint
  npm install -g prettier
}

setup_jvm() {
  sudo apt -y install openjdk-11-jdk

  echo "deb https://repo.scala-sbt.org/scalasbt/debian all main" | sudo tee /etc/apt/sources.list.d/sbt.list
  echo "deb https://repo.scala-sbt.org/scalasbt/debian /" | sudo tee /etc/apt/sources.list.d/sbt_old.list
  curl -sL "https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x2EE0EA64E40A89B84B2DF73499E82A75642AC823" | sudo apt-key add
  sudo apt-get update
  sudo apt-get install sbt
}

setup_misc() {
  sudo apt -y install tree
  npm install -g tldr
}

teardown_all() {
  sudo apt -y autoremove
}

setup_all
setup_git
setup_js
setup_tmux
setup_vim
setup_bash
setup_jvm
setup_misc
teardown_all
