#!/bin/bash

set -e

setup_all() {
  sudo apt -y update && sudo apt -y upgrade
  sudo apt -y install build-essential
  rm -rf $HOME/.vim
}

setup_git() {
  sudo apt -y install git
  wget -O $HOME/.gitconfig https://raw.githubusercontent.com/kazimir-malevich/dotfiles/master/.gitconfig
}

setup_vim() {
  plugins_start_dir="$HOME/.vim/pack/plugins/start/"

  sudo apt -y install vim
  wget -O $HOME/.vimrc https://raw.githubusercontent.com/kazimir-malevich/dotfiles/master/.vimrc

  mkdir -p $plugins_start_dir && cd $plugins_start_dir

  declare -a plugins
  plugins=("dense-analysis/ale.git" "tpope/vim-commentary" "ctrlpvim/ctrlp.vim.git" "christoomey/vim-tmux-navigator")
  cd $plugins_start_dir

  for i in ${plugins[@]}; do
    git clone "https://github.com/${i}"
  done
}

setup_bash() {
cat <<EOT >> $HOME/.bashrc

alias vi='vim'
alias ..="cd .."
alias ll='ls -lahF'
alias cl='clear'
alias py='python3'
alias python='python3'
alias pip='pip3'

export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
export PATH=$PATH:$HOME/.local/bin:$JAVA_HOME/bin
EOT
}

setup_python() {
  sudo apt -y install python3-pip
  python3 -m pip install flake8
}

setup_openjdk() {
  sudo apt -y install openjdk-11-jdk
  cd $HOME
  wget https://github.com/pmd/pmd/releases/download/pmd_releases%2F6.40.0/pmd-bin-6.40.0.zip
  unzip pmd-bin-6.40.0.zip
  alias pmd="$HOME/pmd-bin-6.40.0/bin/run.sh pmd"
  # fork
  bash
  pmd -d /usr/src -R rulesets/java/quickstart.xml -f text
}

setup_tmux() {
  sudo apt -y install tmux
  wget -O $HOME/.tmux.conf https://raw.githubusercontent.com/kazimir-malevich/dotfiles/master/.tmux.conf
}

setup_misc() {
  sudo apt -y install tree
}

teardown_all() {
  sudo apt -y autoremove
}

setup_all
setup_git
setup_vim
setup_tmux
setup_bash
setup_python
setup_openjdk
setup_misc
teardown_all
